{
	"name": "openData_CoursesWithVenues",
	"properties": {
		"folder": {
			"name": "openData"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "openData_Cache_Courses",
						"type": "DatasetReference"
					},
					"name": "Courses"
				},
				{
					"dataset": {
						"referenceName": "openData_Cache_Venues",
						"type": "DatasetReference"
					},
					"name": "Venues"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "openData_Cache_CoursesWithVenues",
						"type": "DatasetReference"
					},
					"name": "Cache"
				}
			],
			"transformations": [
				{
					"name": "JoinCoursesWithVenues"
				},
				{
					"name": "Transform"
				}
			],
			"script": "source(output(\n\t\tProviderUkprn as string,\n\t\tCourseId as string,\n\t\tLearnAimRef as string,\n\t\tCourseName as string,\n\t\tCourseDescription as string,\n\t\tCourseURL as string,\n\t\tCost as integer,\n\t\tCostDescription as string,\n\t\tFlexibleStartDate as boolean,\n\t\tStartDate as date,\n\t\tDurationUnit as integer,\n\t\tDurationValue as integer,\n\t\tDeliveryMode as integer,\n\t\tAttendancePattern as integer,\n\t\tNational as boolean,\n\t\tRegions as string[],\n\t\tRegionsString as string,\n\t\tVenueId as string,\n\t\tUpdatedDate as date,\n\t\tRecordStatus as integer\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false) ~> Courses\nsource(output(\n\t\tAddress1 as string,\n\t\tAddress2 as string,\n\t\tCounty as string,\n\t\tEmail as string,\n\t\tLatitude as double,\n\t\tLongitude as double,\n\t\tPostcode as string,\n\t\tProviderUkprn as integer,\n\t\tTelephone as string,\n\t\tTown as string,\n\t\tVenueId as string,\n\t\tVenueName as string,\n\t\tWebsite as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false) ~> Venues\nCourses, Venues join(Courses@VenueId == Venues@VenueId,\n\tjoinType:'left',\n\tbroadcast: 'auto')~> JoinCoursesWithVenues\nJoinCoursesWithVenues select(skipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Transform\nTransform sink(input(\n\t\tProviderUkprn as string,\n\t\tCourseId as string,\n\t\tLearnAimRef as string,\n\t\tCourseName as string,\n\t\tCourseDescription as string,\n\t\tCourseURL as string,\n\t\tCost as string,\n\t\tCostDescription as string,\n\t\tFlexibleStartDate as boolean,\n\t\tStartDate as string,\n\t\tDurationUnit as string,\n\t\tDurationValue as string,\n\t\tDeliveryMode as string,\n\t\tAttendancePattern as string,\n\t\tNational as boolean,\n\t\tRegions as string[],\n\t\tRegionsString as string,\n\t\tVenueName as string,\n\t\tAddress1 as string,\n\t\tAddress2 as string,\n\t\tCounty as string,\n\t\tEmail as string,\n\t\tLatitude as double,\n\t\tLongitude as double,\n\t\tPostcode as string,\n\t\tTelephone as string,\n\t\tTown as string,\n\t\tWebsite as string,\n\t\tUpdatedDate as string,\n\t\tRecordStatus as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tpartitionFileNames:['courses-with-venues.json'],\n\tmapColumn(\n\t\tProviderUkprn,\n\t\tCourseId,\n\t\tLearnAimRef,\n\t\tCourseName,\n\t\tCourseDescription,\n\t\tCourseURL,\n\t\tCost,\n\t\tCostDescription,\n\t\tFlexibleStartDate,\n\t\tStartDate,\n\t\tDurationUnit,\n\t\tDurationValue,\n\t\tDeliveryMode,\n\t\tAttendancePattern,\n\t\tNational,\n\t\tRegions,\n\t\tRegionsString,\n\t\tVenueId,\n\t\tUpdatedDate,\n\t\tRecordStatus,\n\t\tAddress1,\n\t\tAddress2,\n\t\tCounty,\n\t\tEmail,\n\t\tLatitude,\n\t\tLongitude,\n\t\tPostcode,\n\t\tTelephone,\n\t\tTown,\n\t\tVenueName,\n\t\tWebsite\n\t),\n\tpartitionBy('hash', 1),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Cache"
		}
	}
}